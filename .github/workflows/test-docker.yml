name: test-docker-image

on:
  [ push, pull_request ]

jobs:
  test-docker-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Build test environment
        working-directory: docker/tests
        run: |
          docker compose build
      - name: Run containers
        working-directory: docker/tests
        run: |
          docker compose up -d
      - name: Run tests
        run: |
          docker exec subscriber wis2downloader list-subscriptions
      - name: Shutdown
        working-directory: docker/tests
        run: |
          docker compose down